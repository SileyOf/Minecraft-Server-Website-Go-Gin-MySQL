<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å…¬å‘Š - HXZD</title>
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/sao-buttons.css">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@300;400;700&display=swap" rel="stylesheet">
</head>
<body>
    <div class="custom-bg" id="customBg"></div>
    <nav class="sao-nav" id="saoNav">
        <div class="sao-nav-container">
            <a href="index.html" class="sao-btn" data-index="0"><span class="sao-btn-icon">âŒ‚</span><span class="sao-btn-text">Home</span><span class="sao-btn-diamond"></span></a>
            <a href="gameplay.html" class="sao-btn" data-index="1"><span class="sao-btn-icon">âš”</span><span class="sao-btn-text">ç©æ³•</span><span class="sao-btn-diamond"></span></a>
            <a href="map.html" class="sao-btn" data-index="2"><span class="sao-btn-icon">ğŸ—º</span><span class="sao-btn-text">ä¸–ç•Œåœ°å›¾</span><span class="sao-btn-diamond"></span></a>
            <a href="announcements.html" class="sao-btn active" data-index="3"><span class="sao-btn-icon">ğŸ“¢</span><span class="sao-btn-text">å…¬å‘Š</span><span class="sao-btn-diamond"></span></a>
            <a href="forum.html" class="sao-btn" data-index="4"><span class="sao-btn-icon">ğŸ’¬</span><span class="sao-btn-text">å¾®è®ºå›</span><span class="sao-btn-diamond"></span></a>
            <a href="about.html" class="sao-btn" data-index="5"><span class="sao-btn-icon">â„¹</span><span class="sao-btn-text">å…³äº</span><span class="sao-btn-diamond"></span></a>
            <a href="status.html" class="sao-btn" data-index="6"><span class="sao-btn-icon">â—‰</span><span class="sao-btn-text">æœåŠ¡å™¨çŠ¶æ€</span><span class="sao-btn-diamond"></span></a>
            <a href="sponsor.html" class="sao-btn" data-index="7"><span class="sao-btn-icon">â™¥</span><span class="sao-btn-text">èµåŠ©</span><span class="sao-btn-diamond"></span></a>
            <a href="login.html" class="sao-btn sao-btn-login" data-index="8" id="navAuthBtn"><span class="sao-btn-icon">â–¸</span><span class="sao-btn-text">ç™»å½•</span><span class="sao-btn-diamond"></span></a>
        </div>
    </nav>
    <div class="particles" id="particles"></div>

    <main class="main-content">
        <div class="page-title-bar">
            <h1 class="page-title"><span class="sao-panel-diamond"></span> å…¬å‘Š</h1>
        </div>
        <div class="announcements-list" id="announcementsList">
            <div class="loading-placeholder">åŠ è½½ä¸­...</div>
        </div>
    </main>

    <div class="sao-corner top-left"></div>
    <div class="sao-corner bottom-right"></div>

    <script src="js/common.js"></script>
    <script>
    document.addEventListener('DOMContentLoaded', async () => {
        HXZD.initNav();
        await HXZD.loadBackground();
        loadAnnouncements();
    });

    async function loadAnnouncements() {
        try {
            const res = await fetch(HXZD.API + '/announcements');
            const data = await res.json();
            const container = document.getElementById('announcementsList');
            if (!data || data.length === 0) {
                container.innerHTML = '<div class="sao-panel" style="padding:32px;text-align:center;color:var(--sao-text-muted)">æš‚æ— å…¬å‘Š</div>';
                return;
            }
            container.innerHTML = data.map(a => `
                <div class="sao-panel announcement-card ${a.is_pinned ? 'pinned' : ''}">
                    <div class="sao-panel-header">
                        <span class="sao-panel-diamond"></span>
                        <span>${a.is_pinned ? '<span class="pin-badge">ğŸ“Œ ç½®é¡¶</span>' : ''}${formatDate(a.created_at)}</span>
                    </div>
                    <div class="announcement-body">
                        <h3>${escapeHtml(a.title)}</h3>
                        <div class="announcement-content">${a.content || ''}</div>
                        <div class="announcement-meta">
                            <span>by ${escapeHtml(a.author?.username || 'ç®¡ç†å‘˜')}</span>
                        </div>
                    </div>
                </div>
            `).join('');
        } catch(e) {
            document.getElementById('announcementsList').innerHTML =
                '<div class="sao-panel" style="padding:32px;text-align:center;color:var(--sao-text-muted)">åŠ è½½å¤±è´¥</div>';
        }
    }

    function formatDate(d) {
        return new Date(d).toLocaleDateString('zh-CN', {year:'numeric',month:'2-digit',day:'2-digit'});
    }
    function escapeHtml(t) {
        const d = document.createElement('div'); d.textContent = t || ''; return d.innerHTML;
    }
    </script>
    <script src="js/particles.js"></script>
</body>
</html>
